-- Table: facilities
-- Stores information about park facilities (e.g., restrooms, laundry rooms).
CREATE TABLE IF NOT EXISTS facilities (
    facility_id INTEGER PRIMARY KEY AUTOINCREMENT,
    facility_name TEXT NOT NULL,
    facility_type TEXT NOT NULL,
    location TEXT,
    is_active INTEGER NOT NULL DEFAULT 1,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table: assets
-- Tracks individual assets within facilities (e.g., a specific washer).
CREATE TABLE IF NOT EXISTS assets (
    asset_id INTEGER PRIMARY KEY AUTOINCREMENT,
    facility_id INTEGER NOT NULL,
    asset_name TEXT NOT NULL,
    asset_type TEXT NOT NULL,
    serial_number TEXT,
    purchase_date DATE,
    is_active INTEGER NOT NULL DEFAULT 1,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (facility_id) REFERENCES facilities(facility_id)
);

-- Table: maintenance_requests
-- Records maintenance requests for facilities or assets.
CREATE TABLE IF NOT EXISTS maintenance_requests (
    request_id INTEGER PRIMARY KEY AUTOINCREMENT,
    facility_id INTEGER,
    asset_id INTEGER,
    customer_id INTEGER,
    request_date DATE NOT NULL,
    priority TEXT NOT NULL,
    status TEXT NOT NULL,
    description TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (facility_id) REFERENCES facilities(facility_id),
    FOREIGN KEY (asset_id) REFERENCES assets(asset_id),
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id),
    CHECK (facility_id IS NOT NULL OR asset_id IS NOT NULL)
);

-- Table: maintenance_schedules
-- Manages scheduled maintenance tasks for facilities or assets.
CREATE TABLE IF NOT EXISTS maintenance_schedules (
    schedule_id INTEGER PRIMARY KEY AUTOINCREMENT,
    facility_id INTEGER,
    asset_id INTEGER,
    task_name TEXT NOT NULL,
    frequency TEXT NOT NULL,
    next_due_date DATE NOT NULL,
    status TEXT NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (facility_id) REFERENCES facilities(facility_id),
    FOREIGN KEY (asset_id) REFERENCES assets(asset_id),
    CHECK (facility_id IS NOT NULL OR asset_id IS NOT NULL)
);

-- Table: maintenance_logs
-- Logs completed maintenance activities for auditing.
CREATE TABLE IF NOT EXISTS maintenance_logs (
    log_id INTEGER PRIMARY KEY AUTOINCREMENT,
    request_id INTEGER,
    schedule_id INTEGER,
    facility_id INTEGER,
    asset_id INTEGER,
    completion_date DATE NOT NULL,
    performed_by TEXT NOT NULL,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (request_id) REFERENCES maintenance_requests(request_id),
    FOREIGN KEY (schedule_id) REFERENCES maintenance_schedules(schedule_id),
    FOREIGN KEY (facility_id) REFERENCES facilities(facility_id),
    FOREIGN KEY (asset_id) REFERENCES assets(asset_id),
    CHECK (facility_id IS NOT NULL OR asset_id IS NOT NULL)
);